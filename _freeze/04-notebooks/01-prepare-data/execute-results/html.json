{
  "hash": "fc50fac0759e12afce70322980b5d1f0",
  "result": {
    "markdown": "---\ntitle: \"Prepare data\"\nfreeze: auto\n---\n\n\n# Prepare data with EDA\n\nThis notebook sets an example workflow and template for preparing raw data for analysis. The focus is on cleaning, coding, and transforming the data, which are crucial steps to ensure the reliability and validity of the analysis. All processing steps should be documented, including the determination of the final sample size, any data exclusions, manipulations, and the creation of variables for the study.\n\n**EDA (Exploratory Data Analysis)** is integrated into the process to understand the distribution of the data and identify any apparent issues that need addressing. After processing, the processed data is saved in CSV format. This approach keeps the raw data untouched and makes all processing steps transparent and reproducible.\n\n**Why prepare data in a notebook instead of a script file?**\n\n-   Working in a notebook, rather than a script file, allows for the inclusion of exploratory data analysis and personal notes while processing data to ensure accurate processing. With the \"purl\" function, explained in the **babysteps** tutorial, only the code chunks will be extracted and saved in a script file for public sharing. The full notebook is intended for personal and collegial use. Feel free to modify the notebook for your style and purposes.\n\n## 1 Load raw data and packages\n\n**Overview:** Start by loading required R packages and your dataset into your analysis environment. For the tutorial, we load the raw data created in the **Simulate-data notebook**.\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: setup_prepare\n# Title: Prepare data\n\n\n# Load required packages\nrequire(here)\n```\n````\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: here\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'here' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nhere() starts at C:/Users/juuso/OneDrive - Vaikuttava Yritys Oy/0 Oma RStudio/ReproRepo\n```\n:::\n\n````{.cell-code}\n```{{r}}\n#| label: setup_prepare\nrequire(tidyverse)\n```\n````\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: tidyverse\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'tidyverse' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'tibble' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'forcats' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.0     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n````{.cell-code}\n```{{r}}\n#| label: setup_prepare\n# load the raw data\ndataset <- read.csv(here(\"01-data/raw/babysteps-rawdata.csv\"))\n```\n````\n:::\n\n\n## Check and Modify Data Types\n\nBefore diving into EDA, it's crucial to ensure that each variable in your dataset is stored in the most appropriate data type. Correct data types can improve computational efficiency and are essential for appropriate analysis techniques.\n\n-   **Action Steps:** Start by listing the current data types of variables in your dataset. This helps identify any variables that may be incorrectly typed, such as numeric variables recognized as character data due to formatting issues.\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# Display the current data types of all variables in the dataset\nstr(dataset)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t300 obs. of  8 variables:\n $ BabyID     : int  1 2 3 4 5 6 7 8 9 10 ...\n $ StepType   : chr  \"Walking\" \"Walking\" \"Walking\" \"Toddling\" ...\n $ AgeMonths  : int  14 13 13 14 12 12 14 13 13 13 ...\n $ Wave       : chr  \"T1\" \"T1\" \"T1\" \"T1\" ...\n $ SleepHours : int  13 11 10 13 10 13 14 13 11 11 ...\n $ FeedingType: chr  \"Breastfed\" \"Formula\" \"Breastfed\" \"Formula\" ...\n $ PuzzleTime : num  49.1 43.3 28.6 47.3 71.8 62.4 67.6 77.6 53.8 59.9 ...\n $ GiggleCount: int  24 20 9 24 30 25 21 34 16 32 ...\n```\n:::\n:::\n\n\n-   **Convert Data Types:** Based on the initial inspection, convert variables to their correct data types. Common conversions include transforming character variables that represent categories into factors and ensuring numeric variables are not mistakenly treated as character or factor types.\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# Example code to modify data types\n# Adjust the following commands according to the specific needs of your dataset.\n\n# Converting character variables to factors (for categorical variables with a limited number of categories)\ndataset <- dataset %>% mutate_if(is.character, as.factor)\n\n# Converting factors to character (if necessary for string processing)\n# dataset <- dataset %>% mutate_if(is.factor, as.character)\n\n# Converting integers to numeric\n# dataset <- dataset %>% mutate_if(is.integer, as.numeric)\n\n# Recheck data types\nstr(dataset)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t300 obs. of  8 variables:\n $ BabyID     : int  1 2 3 4 5 6 7 8 9 10 ...\n $ StepType   : Factor w/ 3 levels \"Crawling\",\"Toddling\",..: 3 3 3 2 3 2 2 2 3 1 ...\n $ AgeMonths  : int  14 13 13 14 12 12 14 13 13 13 ...\n $ Wave       : Factor w/ 3 levels \"T1\",\"T2\",\"T3\": 1 1 1 1 1 1 1 1 1 1 ...\n $ SleepHours : int  13 11 10 13 10 13 14 13 11 11 ...\n $ FeedingType: Factor w/ 2 levels \"Breastfed\",\"Formula\": 1 2 1 2 1 1 2 1 2 2 ...\n $ PuzzleTime : num  49.1 43.3 28.6 47.3 71.8 62.4 67.6 77.6 53.8 59.9 ...\n $ GiggleCount: int  24 20 9 24 30 25 21 34 16 32 ...\n```\n:::\n:::\n\n\n## Initial Exploratory Data Analysis\n\nBefore further processing, you may want to conduct an exploratory data analysis (EDA) to gain insights into the dataset's distribution and characteristics. There are various ways to do this and also packages for automated EDA analysis (e.g., DataExplorer, GGally, SmartEDA, Hmisc). For this tutorial, we will use the DataExplorer.\n\n-   **Action Steps:** Run the code below to create an EDA report. Then check results from your Notebooks folder.\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: \"Initial EDA\"\n#| purl: false # to exclude this chunk from the R script file\n#| eval: false\n\n# Load/Install DataExplorer package\nif (!requireNamespace(\"DataExplorer\", quietly = TRUE)) {install.packages(\"DataExplorer\")}\nrequire(DataExplorer)\n\n# Create the report\ndataset %>%\n    create_report(\n        output_file = paste(\"EDA-report-initial\", Sys.Date(), sep=\"-\"), # filename\n        report_title = \"Initial EDA Report - Babysteps Dataset\",\n        y = 'PuzzleTime' # to set the outcome variable\n    )\nmessage(\"The EDA report was created and saved in your notebooks folder\")\n```\n````\n:::\n\n\n## Data Cleaning\n\nThis step involves identifying and correcting issues in your dataset, such as missing values, errors, outliers, and standardizing variable names, to ensure data quality.\n\n### Identifying Missing Values\n\n-   **Overview:** Begin by identifying missing values in your dataset. Missing data can occur for various reasons, from non-response in surveys to errors in data entry.\n-   **Action Steps:** Use descriptive statistics to identify missing patterns and decide on appropriate methods for handling them, such as imputation or exclusion, based on the nature of your data.\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: Missing-values\n# insert your code here or delete the section\n```\n````\n:::\n\n\n### Correcting Errors\n\n-   **Overview:** Data entry errors, inconsistencies in response formats, and other inaccuracies can significantly affect your analysis.\n-   **Action Steps:** Validate data ranges (e.g., ages within plausible limits) and consistency (e.g., gender coded uniformly). Correct identified errors where possible, or note them for exclusion or special consideration.\n\n\n::: {.cell}\n\n:::\n\n\n### Handling Outliers\n\n-   **Overview:** Outliers can influence statistical analyses and may represent either genuine phenomena or data errors.\n-   **Action Steps:** Identify outliers through visual (e.g., boxplots) and statistical methods. Investigate their origins and decide whether to keep, adjust, or remove them, documenting your rationale.\n\n\n::: {.cell}\n\n:::\n\n\n### **Standardize Variable Names**\n\nEnsure all variable names are in lowercase to maintain consistency across your dataset. This can help avoid case-sensitive errors in your analysis scripts.\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: Standardize Variable Names\n\n# lowercase all variables (good practice)\ndataset <- dataset %>% rename_all(tolower)\n```\n````\n:::\n\n\n*Tip. Check out clean.names() function from janitor package to clean up variable names.*\n\n## Data Recoding and Transformation\n\nThis step encompasses the processes of adjusting your variables to better fit your analysis needs and preparing your data through various transformations. It ensures that your dataset is in the optimal form for analysis, addressing both the structure of your data and the scales of measurement.\n\n### Recoding Variables\n\n-   **Overview:** Recoding involves adjusting existing variables to better fit your analysis needs, such as combining categories of a nominal variable or changing measurement scales.\n-   **Action Steps:** Clearly define your recoding rules and apply them uniformly across your dataset. Document changes to ensure transparency and reproducibility.\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: \"Recoding variables\"\n\n# Recode wave into an integer for regression analyses\ndataset$wave <- as.integer(gsub(\"T\", \"\", dataset$wave))\n\n# create a new categorical variable AgeGroup\ndataset <- dataset %>%\n  mutate(agegroup = case_when(\n    agemonths <= 14 ~ \"12-14 months\",\n    agemonths <= 20 ~ \"15-20 months\",\n    TRUE ~ \"21-24 months\"\n  ))\n```\n````\n:::\n\n\n### Normalizing Scales\n\n-   **Overview:** Variable scales may need normalization, especially when combining data from different sources or preparing for certain statistical analyses.\n-   **Action Steps:** Apply normalization techniques, such as z-score standardization or min-max scaling, to adjust scales. Choose a method appropriate for your data distribution and analysis requirements.\n\n### Creating Dummy Variables\n\n-   **Overview:** Dummy variables are used to represent categorical data in binary form, which is necessary for many types of statistical modeling.\n-   **Action Steps:** Convert categorical variables into dummy variables as needed.\n\n## Post-Cleaning EDA\n\nAfter cleaning and transforming your data, perform another round of EDA to verify the data preparation steps' effects and ensure the dataset is ready for analysis. Look for any remaining issues to check the data quality and structure post-cleaning.\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: \"EDA-with-processed-data\"\n#| purl: false    # to exclude this chunk from the R script file\n#| eval: false\n\n# Create the report\ndataset %>%\n    create_report(\n        output_file = paste(\"EDA-report-processed\", Sys.Date(), sep=\" - \"),\n        report_title = \"EDA Report with processed data - Babysteps Dataset\",\n        y = 'puzzletime'\n    )\nmessage(\"The EDA report was created and saved in your notebooks folder\")\n```\n````\n:::\n\n\n## Save the processed data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: \"Save dataset\"\n# Save in CSV format into processed data -subfolder\nwrite.csv(dataset, here(\"01-data/processed/babysteps.csv\"), row.names = FALSE)\n```\n````\n:::\n\n\n# Conclusion\n\nThis workflow guides you from loading your data to ensuring it's analytically ready, highlighting the iterative nature of data preparation. By incorporating initial and post-cleaning EDA, you continuously validate your steps and decisions, enhancing the reliability and validity of your research findings.\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\npng(\"test.png\")\nplot(1, main = \"Test\")\ndev.off()\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\npng \n  2 \n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}